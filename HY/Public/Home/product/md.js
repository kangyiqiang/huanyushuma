define('md.mall.head',function(require,exports,module){var $=require('jquery'),formatJson=require('formatJson'),cookie=require('cookie'),mXss=require('xss'),report=require('report');function initHeadEvent(){var IS_ENTERPRISE_BUY=isEnterpriseBuy();if(cookie.get('uin')||cookie.get('uid')){$.ajax({type:'get',dataType:'jsonp',url:'//mall.midea.com/my/index/getuserinfo?callback=getuserinfoCB',error:function(result){},success:function(obj){if(obj.errcode=="0"||obj.errcode==1003){var oUserInfo=obj.userInfo||{};var jOptWrap=$('#optWrap');var nickName=oUserInfo.strNickname||'用户'+cookie.get('uid');if(oUserInfo.nUinType==2){jOptWrap.addClass('enterprise_has_login');var $optEnterpriseUserLoginSuccess=$('.js_opt_enterprise_user_login_success');if(nickName.length>15){nickName=nickName.substr(0,15)+'...'}
$optEnterpriseUserLoginSuccess.find('.js_user_login_name').html(mXss.parse(nickName,'html'));if(oUserInfo.strImageUrl){$optEnterpriseUserLoginSuccess.find('.js_user_login_img').attr('src',oUserInfo.strImageUrl);jOptWrap.addClass('has_user_img');}else{jOptWrap.removeClass('has_user_img');}}else if(oUserInfo.nUinType!=2){jOptWrap.addClass('has_login');var $optUserLoginSuccess=$('.js_opt_user_login_success');$optUserLoginSuccess.find('.js_user_login_name').html(mXss.parse(nickName,'html'));if(oUserInfo.strImageUrl){$optUserLoginSuccess.find('.js_user_login_img').attr('src',oUserInfo.strImageUrl);jOptWrap.addClass('has_user_img');}else{jOptWrap.removeClass('has_user_img');}
if(oUserInfo.nUserType&2){$('#rowInternal').show();$('#navInternal').show();if($('.interval_tag1').length>0){$('.interval_tag1').show();$('.interval_tag0').remove();}else{$('.interval_tag0').show();}
manageInternal();}else{$('.interval_tag1').remove();}
if((oUserInfo.nUserType&8)!=0){showBatchOrderEntrance();}else{hideBatchOederEntrance();}}}}});}else{$('#optWrap').removeClass('has_login, enterprise_has_login');$('#unloginStatus').css("display","block");}
var hoverDelay=300;var itemHoverTimer;var itemHoverClass='item_all_hover';var $itemAll=$('.nav_wrap .item_all');var $subNav=$('.sub_nav_wrap');$itemAll.hover(function(){$(this).addClass(itemHoverClass);$subNav.show();clearTimeout(itemHoverTimer);},function(){var that=this;itemHoverTimer=setTimeout(function(){$(that).removeClass(itemHoverClass);$subNav.hide();},hoverDelay);});$('.sub_nav_wrap').hover(function(){clearTimeout(itemHoverTimer);},function(){itemHoverTimer=setTimeout(function(){$itemAll.removeClass(itemHoverClass);$subNav.hide();},hoverDelay);});$('.opt_search').hover(function(){$(this).addClass('opt_search_hover');if($(this).find('input[type="search"]').val()!=''){$(this).addClass('opt_search_focus');}},function(){}).find('input').on('focus',function(){$(this).parents('.opt_search').addClass('opt_search_focus');}).on('blur',function(){$(this).parents('.opt_search').removeClass('opt_search_focus');});$("body").on("click",function(){$('.opt_search').removeClass('opt_search_hover');});$(".opt_search").on("click",function(e){e.stopPropagation();$('.opt_search').addClass('opt_search_hover');});var wxHoverTimer;$('.opt_wx').hover(function(){$(this).addClass('opt_wx_hover');$('.wx_wrap').show();clearTimeout(wxHoverTimer);},function(){var that=this;wxHoverTimer=setTimeout(function(){$(that).removeClass('opt_wx_hover');$('.wx_wrap').hide();},hoverDelay);});$('.wx_wrap').hover(function(){clearTimeout(wxHoverTimer);},function(){wxHoverTimer=setTimeout(function(){$('.opt_wx').removeClass('opt_wx_hover');$('.wx_wrap').hide();},hoverDelay);});var userHoverTimer;var userHasLoginDiv=$('.JS_user_haslogin_wrap');$('.opt_user_login_success').hover(function(){$(this).addClass('opt_user_hover');userHasLoginDiv.show();clearTimeout(userHoverTimer);},function(){var that=this;userHoverTimer=setTimeout(function(){$(that).removeClass('opt_user_hover');userHasLoginDiv.hide();},hoverDelay);});userHasLoginDiv.hover(function(){clearTimeout(userHoverTimer);},function(){userHoverTimer=setTimeout(function(){$('.opt_user_login_success').removeClass('opt_user_hover');userHasLoginDiv.hide();},hoverDelay);});var enterpriseUserHoverTimer;var enterpriseUserHasLoginDiv=$('.js_enterprise_user_haslogin_wrap');$('.opt_enterprise_user_login_success').hover(function(){$(this).addClass('opt_user_hover');enterpriseUserHasLoginDiv.show();clearTimeout(enterpriseUserHoverTimer);},function(){var that=this;enterpriseUserHoverTimer=setTimeout(function(){$(that).removeClass('opt_user_hover');enterpriseUserHasLoginDiv.hide();},hoverDelay);});enterpriseUserHasLoginDiv.hover(function(){clearTimeout(enterpriseUserHoverTimer);},function(){enterpriseUserHoverTimer=setTimeout(function(){$('.opt_enterprise_user_login_success').removeClass('opt_user_hover');enterpriseUserHasLoginDiv.hide();},hoverDelay);});if(!IS_ENTERPRISE_BUY){var userUnLoginHoverTimer;var userUnLoginDiv=$('.JS_user_unlogin_wrap');$('.opt_user_login_fail').hover(function(){$(this).addClass('opt_user_hover');userUnLoginDiv.show();clearTimeout(userUnLoginHoverTimer);},function(){var that=this;userUnLoginHoverTimer=setTimeout(function(){$(that).removeClass('opt_user_hover');userUnLoginDiv.hide();},hoverDelay);});userUnLoginDiv.hover(function(){clearTimeout(userUnLoginHoverTimer);},function(){userUnLoginHoverTimer=setTimeout(function(){$('.opt_user_login_fail').removeClass('opt_user_hover');userUnLoginDiv.hide();},hoverDelay);});}
$('.opt_user_login_success').on('click',function(){location.href='//mall.midea.com/my/index?mtag=40005.1.9';});$('.opt_enterprise_user_login_success').on('click',function(){location.href='//mall.midea.com/order/buyer/orderlist';});$('.opt_user_login_fail').on('click',function(){location.href=IS_ENTERPRISE_BUY?'https://mall.midea.com/enterprise/login/web_login':'https://mall.midea.com/login/web?rurl=http%3A%2F%2Fmall.midea.com%2Fmy%2Findex?mtag=40005.1.9';});$('.row_login_out').on('click',function(){$.ajax({type:'get',dataType:'json',async:false,timeout:5000,url:'//mall.midea.com/next/userinfo/logout',error:function(){var date=new Date();date.setTime(date.getTime()-10000);cookie.del("uin","/","midea.com",date.toGMTString());cookie.del("uid","/","midea.com",date.toGMTString());cookie.del("wxwebop","/","midea.com",date.toGMTString());cookie.del("qop","/","midea.com",date.toGMTString());cookie.del("wxopenid","/","midea.com",date.toGMTString());cookie.del("skey","/","midea.com",date.toGMTString());},success:function(obj){if(obj.data.errcode!=0){var date=new Date();date.setTime(date.getTime()-10000);cookie.del("uin","/","midea.com",date.toGMTString());cookie.del("uid","/","midea.com",date.toGMTString());cookie.del("wxwebop","/","midea.com",date.toGMTString());cookie.del("qop","/","midea.com",date.toGMTString());cookie.del("wxopenid","/","midea.com",date.toGMTString());cookie.del("skey","/","midea.com",date.toGMTString());}}});if($('#optWrap').hasClass('enterprise_has_login')){location.href='https://mall.midea.com/enterprise/login/web_login';}else{location.reload();}});var $searchWrap=$('.search_wrap'),$form=$searchWrap.find('form').eq(0),$input=$searchWrap.find('input').eq(0),$defaultLink=$searchWrap.find('input[name="default_link"]');$form.on('submit',function(e){e.preventDefault();if($.trim($input.val())==''){location.href=$defaultLink.val();}else{$(this).get(0).submit();}
return false;});$searchWrap.find('.icon_opt').on('click',function(e){e.preventDefault();if($.trim($input.val())==''){location.href=$defaultLink.val();}else{$form.submit();}
return false;});$('#footLinkWrap').on('click',function(){$(this).toggleClass('foot_links_on');});}
function isEnterpriseBuy(){var pathName=location.pathname;var enterpriseMap=['/enterprise/','/next/qyuser/'];var result=false;$.each(enterpriseMap,function(n,item){if(pathName.indexOf(item)===0){result=true;}});return result;}
function initMainLeftNav(){activeLiCur();toggleLeftNav();}
function activeLiCur(){var themeName=$.trim($('#themeName').val());if($('.left_wrap')[0]){var navA=$('.left_wrap').find('a');var navALength=navA.length;for(var i=0;i<navALength;i++){if(themeName==$.trim(navA.eq(i).text())){navA.eq(i).attr("href","###");navA.eq(i).parent('li').addClass('cur');if(navA.eq(i).parents('.left_sub_nav')[0]){navA.eq(i).parents('.left_nav_li').addClass('child_cur');}}}}
if($('.set_bar_wrap')[0]){var navB=$('.set_bar_wrap').find('a');var navBLength=navB.length;for(var i=0;i<navBLength;i++){if(themeName==$.trim(navB.eq(i).children('.bar_nav_word').text())){navB.eq(i).parent('li').addClass('cur');if(navB.eq(i).parents('.bar_sub_nav')[0]){navB.eq(i).parents('.bar_nav_li').addClass('child_cur');}}}}
if($('.side_bar_wrap')[0]){var navC=$('.side_bar_nav').find('a');var navCLength=navC.length;for(var i=0;i<navCLength;i++){if(themeName==$.trim(navC.eq(i).children('.side_bar_nav_word').text())){navC.eq(i).parent('li').addClass('cur');if(navC.eq(i).parents('.bar_sub_nav')[0]){navC.eq(i).parents('.bar_nav_li').addClass('child_cur');}}}}
if($('.side_bar_nav')[0]){$.ajax({url:'/my/index/get_red_dot',type:'get',dataType:'json',cache:false}).done(function(obj){if(obj.errcode===0){var arrDot=obj.arrDot;if(arrDot.couponDot){$('.js_coupon_tag').removeClass('hide');}
if(arrDot.favoritesDot){$('.js_collect_tag').removeClass('hide');}}else{}}).fail(function(){}).always(function(){});}
$(".js_red_dot").on("click",function(e){e.preventDefault();var link=$(this).attr("href");var type=$(this).attr("data-type");var _id=23;if(type=='collect'){_id=24;}
$.ajax({type:'GET',url:'/my/index/data_click_notify',data:{id:_id},timeout:10000,dataType:'jsonp',success:function(data){window.location.href=link;},error:function(){window.location.href=link;}});});}
function toggleLeftNav(){if($('.left_nav_li')[0]){$('.left_nav_li .icon_swtch_nav').on("click",function(){if($(this).parent().hasClass("child_cur")){$(this).parent().removeClass("child_cur");}
else{$(this).parent().addClass("child_cur");}});}
if($('.bar_nav_li')[0]){$('.bar_nav_li .icon_swtch_nav').on("click",function(){if($(this).parent().hasClass("child_cur")){$(this).parent().removeClass("child_cur");}
else{$(this).parent().addClass("child_cur");}});}}
function initHeadNavCur(){var thisUrl=location.href;var hrefArray=[];var about=["/about_midea","/news_center","/investor_relations","/solution","/infomation","/wbwx","/subject","/video"];hrefArray.push(about);var myProduct=["/service/index/detail"];hrefArray.push(myProduct);var service=["/service/index","/my/warranty/record","/service_support","/service/search","/my/index/record"];hrefArray.push(service);var internal=["/my/internal"];hrefArray.push(internal);var cooperation=["/company/cooperation"];hrefArray.push(cooperation);var flag=false;for(var i=0;i<hrefArray.length;i++){if(flag){break;}
var jLength=hrefArray[i].length;for(var j=0;j<jLength;j++){if(thisUrl.indexOf(hrefArray[i][j])>-1){if(i==0){addItemOn("美的集团");flag=true;break;}
else if(i==1){addItemOn("个人产品");flag=true;break;}
else if(i==2){addItemOn("服务支持");flag=true;break;}else if(i==3){addItemOn("美的员工福利频道");flag=true;break;}else if(i==4){addItemOn("企业采购");flag=true;break;}}}}
if(!flag){addItemOn("美的商城");}}
function addItemOn(str){var navList=$('#topNavWrap li');var navListLength=navList.length;for(var n=0;n<navListLength;n++){if($.trim(navList.eq(n).find("a").html())==str){navList.eq(n).addClass('item_on');break;}}}
function manageOperationTime(){var oTimes=$(".operation_time");oTimes.each(function(){var $this=$(this);var startTime=$this.attr("data-time-start");var endTime=$this.attr("data-time-end");var timeRex=/^\d{4}\/\d{2}\/\d{2} \d{2}\:\d{2}\:\d{2}$/;if(timeRex.test(startTime)&&timeRex.test(endTime)){var now=new Date();var t1=new Date(startTime);var t2=new Date(endTime);if(t1<now&&t2>now){$this.css("display","block");}else{$this.remove();}}else{$this.remove();}});}
function showBatchOrderEntrance(){$('.row_batch_order').removeClass('hide').unbind().on('click',function(){location.href='//mall.midea.com/order/buyer_batch/confirm_order';});$('#js_batchOrderEntrance').removeClass('hide');}
function hideBatchOederEntrance(){$('.row_batch_order').addClass('hide').unbind();$('#js_batchOrderEntrance').addClass('hide');}
function initActDot(){var $oAct=$(".row_my_act");if($oAct.length>0){$(".js_act_dot").show();}}
function manageInternal(){var day=new Date().getDate(),$rowInternal=$("#rowInternal"),$iconNewFunction=$rowInternal.find(".icon_new_function");if(day>=17&&day<=25){$('#dot').show();$iconNewFunction.show();}else{$iconNewFunction.hide();}}
function initCartEvent(){if(cookie.get("uin")||cookie.get("uid")){$.ajax({type:"GET",dataType:"jsonp",url:"//mall.midea.com/my/index/ajax_index_cart_num?callback=cartData",success:function(obj){if(obj.errcode===0){var cartSum=obj.data.nCount;if(!cartSum){$('.js_header_cart_num').html('');initCartHoverEvent('nothing');}else{$('.js_header_cart_num').html(cartSum);initCartHoverEvent('something');}}else{initCartHoverEvent('nothing');}},error:function(){initCartHoverEvent('nothing');}});}else{initCartHoverEvent('login');}}
function reloadCartList(){if(cookie.get("uin")||cookie.get("uid")){$.ajax({type:"GET",dataType:"jsonp",url:"//mall.midea.com/cart/index/ajax_query_cart_sum?callback=cartData",success:function(obj){if(obj.errcode===0){var cartSum=obj.data.cartSum;if(cartSum==0){$('.js_header_cart_num').html('');initCartNothingEvent();offCartHoverEvent();initCartHoverEvent('nothing');}else{$('.js_header_cart_num').html(cartSum);initCartData();}}else{initCartNothingEvent();offCartHoverEvent();initCartHoverEvent('nothing');}},error:function(){initCartNothingEvent();offCartHoverEvent();initCartHoverEvent('nothing');}});}else{initCartLoginEvent();}}
function initCartData(){$.ajax({type:"GET",dataType:"jsonp",url:"//mall.midea.com/cart/index/ajax_query_cart_cover?callback=cartData",success:function(data){if(data){$('.js_common_cart_list').html(data);initCartSomethingEvent();initCartDeleteEvent();}else{initCartHoverEvent('nothing');}},error:function(){initCartHoverEvent('nothing');}});}
function initCartDeleteEvent(){$('.js_common_cart_delete').on('click',function(){var itemId=$(this).attr('data-id');var arrId=[itemId];$.ajax({type:"GET",data:{'arr_id':arrId},dataType:"jsonp",url:"//mall.midea.com/cart/index/ajax_delete_header_item?callback=cartData",success:function(data){if(data.errcode==0||data.errcode==0x21531003){reloadCartList();}},error:function(data){reloadCartList();}});})}
function offCartHoverEvent(){var domOptCart=$('.opt_cart');domOptCart.off('click');domOptCart.off('hover');$('.common_cart_wrap').off('hover');}
function initCartHoverEvent(type){var initDataFlag=true;var cartHoverTimer;var hoverDelay=300;var domOptCart=$('.opt_cart');domOptCart.on('click',function(){location.href='//mall.midea.com/cart';});domOptCart.hover(function(){domOptCart.addClass('opt_cart_hover');switch(type){case'login':initCartLoginEvent();break;case'something':if(initDataFlag){initCartData();}
break;case'nothing':initCartNothingEvent();break;default:initCartNothingEvent();break;}
clearTimeout(cartHoverTimer);},function(){cartHoverTimer=setTimeout(function(){domOptCart.removeClass('opt_cart_hover');$('.common_cart_wrap').removeClass('common_cart_wrap_login common_cart_wrap_nothing common_cart_wrap_something');},hoverDelay);});$('.common_cart_wrap').hover(function(){clearTimeout(cartHoverTimer);},function(){cartHoverTimer=setTimeout(function(){domOptCart.removeClass('opt_cart_hover');$('.common_cart_wrap').removeClass('common_cart_wrap_login common_cart_wrap_nothing common_cart_wrap_something');},hoverDelay);})}
function initCartLoginEvent(){$('.common_cart_wrap').css('right',$('.opt_user').outerWidth()).removeClass('common_cart_wrap_something common_cart_wrap_nothing').addClass('common_cart_wrap_login');}
function initCartSomethingEvent(){$('.common_cart_wrap').css('right',$('.opt_user_login_success').outerWidth()).removeClass('common_cart_wrap_login common_cart_wrap_nothing').addClass('common_cart_wrap_something');}
function initCartNothingEvent(){$('.common_cart_wrap').css('right',$('.opt_user_login_success').outerWidth()).removeClass('common_cart_wrap_something common_cart_wrap_login').addClass('common_cart_wrap_nothing');}
exports.init=function(){initHeadNavCur();initHeadEvent();initMainLeftNav();manageOperationTime();initActDot();initCartEvent();}});
